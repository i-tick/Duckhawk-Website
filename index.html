<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1"> -->
    <meta https-equiv="X-UA-Compatible" content="ie=edge">
    <meta https-equiv="Content-Type" content="text/html; charset=UTF-8">
    <link rel="icon" href="./icon.jpeg">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
        integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="app.css">
    <link rel="stylesheet" href="firstpage.css">
    <!-- <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
        integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
        crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
        integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
        crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
        integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
        crossorigin="anonymous"></script>
    <!-- <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"> -->
    <!-- <script src="https://kit.fontawesome.com/75747be11d.js" crossorigin="anonymous"></script> -->

    <script src="https://kit.fontawesome.com/92d607ead1.js" crossorigin="anonymous"></script>
    <script
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCcH5Qy8dTYdMNvQ8ufSzW9wpHY2qGhFK4&libraries=places"></script>
    <title>DuckHawk - Online Shopping.</title>

    <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-analytics.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-messaging.js"></script>
    <script src="https://www.gstatic.com/firebasejs/7.14.0/firebase-functions.js"></script>

    <style>
        html,
        body {
            width: 100%;
            height: 100%;
            margin: 0px;
            padding: 0px;
            overflow-x: hidden;
            background-color: rgb(255, 255, 255);
        }

        @media (min-width: 768px) {
            body {
                overflow-y: hidden;
            }
        }
    </style>

</head>

<body onload="load()">
    <!-- Navbar -->

    <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top" style="z-index: 16;">
        <a class="navbar-brand" href="index.html">DuckHawk</a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <!-- <a class="nav-link" href="#"><i class="fa fa-home"></i> Home <span class="sr-only">(current)</span></a> -->
                </li>
                <!-- <li class="nav-item">
                    <a class="nav-link" href="#" id="sidebarCollapse"><i class="fa fa-location-arrow"></i> <span
                            id="cityname">
                            Location</span> </a>
                </li> -->
            </ul>

            <form class="form-inline my-2 my-lg-0">
                <ul class="navbar-nav mr-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="#" data-toggle="modal" data-target="#login" id="signin"> Sign in </a>
                    </li>
<!--                     <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="myprof" role="button" data-toggle="dropdown"
                            aria-haspopup="true" aria-expanded="false">
                            My Profile
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="#" onclick="prof()">My Profile</a>
                            <a class="dropdown-item" href="#">My Orders</a>
                            <a class="dropdown-item" href="#" onclick="logout()">Log out</a>
                        </div>
                    </li> -->
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            More
                        </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="https://seller.duckhawk.in/">Sell on DuckHawk</a>
                            <a class="dropdown-item" href="#">Contact us</a>
                            <!-- <div class="dropdown-divider"></div> -->
                            <!-- <a class="dropdown-item" href="#">Download app</a> -->
                        </div>
                    </li>
                      <li class="nav-item">
                        <a class="nav-link" href="#" id="about"> About Us </a>
                    </li>
<!--                     <li class="nav-item">
                        <div id="cart" class="som">
                            <a class="nav-link" href="Cart.html">
                                <div id="itemincart" class="cartcount" style="display: none;"></div>
                                <i class="fa fa-shopping-cart"></i>
                                Cart
                            </a>
                        </div>
                    </li> -->
                </ul>
<!--                 <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
                <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button> -->
            </form>
        </div>
    </nav>

    <!-- Modal -->
    <div class="modal fade" id="login" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="exampleModalLabel">Login</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form class="px-4 py-3">
                        <div class="form-group">
                            <label for="email">Email address</label>
                            <input type="email" class="form-control" placeholder="Enter Email" name="email" required
                                id="lemail" autocomplete="off" value="">
                        </div>
                        <div class="form-group">
                            <label for="psw">Password</label>
                            <input type="password" class="form-control" placeholder="Enter Password" name="psw" required
                                id="lpassword">
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="dropdownCheck">
                            <label class="form-check-label" for="dropdownCheck">
                                Remember me
                            </label>
                        </div>
                    </form>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="#" data-toggle="modal" data-target="#forget" data-dismiss="modal">Forgot
                        password?</a>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="login()" id="loginbtn">Login</button>
                    <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#signup"
                        data-dismiss="modal">Sign up</button>

                </div>
            </div>
        </div>
    </div>
    <!-- Forgot Password modal-->
    <div class="modal fade" id="forget" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle"
        aria-hidden="true" style="overflow-y: scroll; max-height:85%;  margin-top: 50px; margin-bottom:50px;">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Reset Password</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form class="px-4 py-3">
                        <div class="form-group">
                            <label for="exampleDropdownFormEmail1">Email</label>
                            <input type="email" class="form-control" placeholder="email" id="useremail">
                        </div>
                    </form>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" onclick="resetPass()">Send password reset
                            link</button>
                        <!-- <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#login" data-dismiss="modal">Login</button> -->


                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- signup -->
    <div class="modal fade" id="signup" tabindex="-1" role="dialog" aria-labelledby="exampleModalLongTitle"
        aria-hidden="true" style="overflow-y: scroll; max-height:85%;  margin-top: 50px; margin-bottom:50px;">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Sign up</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <form class="px-4 py-3">
                        <div class="form-group">
                            <label for="exampleDropdownFormEmail1">Name</label>
                            <input type="text" class="form-control" name="name" placeholder="Enter your name" id="name"
                                required>
                        </div>
                        <div class="form-group">
                            <label for="exampleDropdownFormEmail1">Email</label>
                            <input type="email" class="form-control" name="Email" placeholder="Enter your email"
                                id="email" required>
                        </div>
                        <div class="form-group">
                            <label for="exampleDropdownFormPassword1">Password</label>
                            <input type="password" class="form-control" name="password" placeholder="Enter new password"
                                id="password" pattern="(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}"
                                title="Must contain at least one number and one uppercase and lowercase letter, and at least 8 or more characters"
                                required>
                        </div>
                        <div class="form-group">
                            <label for="exampleDropdownFormPassword1">Phone Number</label>
                            <input type="tel" class="form-control" name="number" id="phonenumber" required
                                placeholder="Enter phone number">
                        </div>
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input">
                            <label class="form-check-label" for="dropdownCheck">
                                Remember me
                            </label>
                        </div>
                    </form>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-primary" onclick="signup()" id="signupbutton">Sign
                            up</button>
                        <button type="button" class="btn btn-secondary" data-toggle="modal" data-target="#login"
                            data-dismiss="modal">Login</button>


                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container-fluid" id="main">
        <div class="row">
            <div class="col-lg-5 col-md-5 d-flex align-items-center" id="inputs">
                <div>
                    <input class="form-control mr-sm-2" title="location" name="locationin" type="text" value=""
                        placeholder="e.g. Bhubaneswar" aria-label="Search" id="locationin" autocomplete="off">
                    <p id="stext">You can search here for area, street name, city, mantions, etc.... <br>
                        <span>Other wise you
                            can give your
                            current location from picking the location from the Map.</span>
                    </p>
                    <button type="button" name="conform" id="conform" class="btn btn-success btn-block">Confirm
                        Location</button>
                </div>
            </div>
            <div class="col-lg-7 col-md-7" id="mapcont">
                <div id="map">

                </div>
                <div class="ifnotper" id="noper">
                    <div class="scrn">

                    </div>
                    <div class="askp">
                        <div class="btnbox" id="reqbtn">
                            <a href="#" style="color:black"><i class="fa fa-crosshairs" aria-hidden="true"></i></a> Locate me.. <br>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="m" style="display: none;"></div>
    <script src="./location.js"></script>
    <!-- <script src="https://unpkg.com/location-picker/dist/location-picker.min.js"></script> -->
    <script src="app.js"></script>
    <script>

        var map = document.getElementById('map');
        var lp = new locationPicker(map, {
            setCurrentPosition: false,
        }, {
            gestureHandling: 'greedy', 
            streetViewControl: false,
            zoomControl: false,
            zoom: 15
        });

        var Loclng;
        var Loclat;

        function handlePermission() {
            navigator.permissions.query({ name: 'geolocation' }).then(function (result) {
                if (result.state == 'granted') {
                    lp.setCurrentPosition();
                    document.getElementById('noper').style.display = 'none'
                    if (localStorage.getItem('Loclat') || localStorage.getItem('cus_city')) {
                        goToHome();
                    }
                    console.log(result.state);
                } else if (result.state == 'prompt') {
                    console.log(result.state);
                    document.getElementById('noper').style.display = 'block'
                    // navigator.geolocation.getCurrentPosition(function(t));
                } else if (result.state == 'denied') {
                    document.getElementById('noper').style.display = 'block'
                    alert("Please give us your Network Permission for better service..");
                    lp.setCurrentPosition();
                    console.log(result.state);
                }
                result.onchange = function () {
                    console.log(result.state);
                    if (result.state == 'granted') {
                        lp.setCurrentPosition();
                        document.getElementById('noper').style.display = 'none'
                    } else if (result.state == 'prompt') {
                        document.getElementById('noper').style.display = 'block'
                    }
                }
            });
        }

        handlePermission()



        document.getElementById('reqbtn').onclick = function () {
            lp.setCurrentPosition();
        }


        document.getElementById('conform').onclick = function () {
            var location = lp.getMarkerPosition();
            localStorage.setItem("Loclat", location.lat);
            localStorage.setItem("Loclng", location.lng);
            setTimeout(() => {
                goToHome()
            }, 30)
        }

        function goToHome() {
            location.href = "./home.html";
        }

        google.maps.event.addListener(lp.map, 'idle', function (event) {

            var location = lp.getMarkerPosition();
            var latitude = location.lat;
            var longitude = location.lng;
            var geocoder;
            geocoder = new google.maps.Geocoder();
            var latlng = new google.maps.LatLng(latitude, longitude, 1);

            geocoder.geocode(
                { 'latLng': latlng },
                function (results, status) {
                    if (status == google.maps.GeocoderStatus.OK) {

                        if (results[0]) {
                            var add = results[0].formatted_address;
                            console.log(add);
                            var value = add.split(",");
                            count = value.length;
                            country = value[count - 1];
                            state = value[count - 2];
                            city = value[count - 3];
                            console.log(value);
                            console.log("city name is: " + city);

                            // localStorage.setItem("Loclat", location.lat);
                            // localStorage.setItem("Loclng", location.lng);
                            localStorage.setItem('cus_city', $.trim(city));

                            console.log('The chosen location is ' + location.lat + ',' + location.lng);
                            cityName = results[0].formatted_address;
                            console.log(cityName);
                        }
                        else {
                            console.log("address not found");
                        }
                    }
                    else {
                        console.log("Geocoder failed due to: " + status);
                    }
                }
            );
        });


        var autocomplete = new google.maps.places.Autocomplete(
      /** @type {!HTMLInputElement} */(
                document.getElementById('locationin')), {
            types: ['address'], types: ['establishment'],
        });
        google.maps.event.addListener(autocomplete, 'place_changed', function () {
            var place = autocomplete.getPlace();
            console.log("place name is ", place);
            selectedcity = place.name.split(',');
            lp.setLocation(place.geometry.location.lat(), place.geometry.location.lng());
        });


    </script>

    <script src="./pace.min.js"></script>

</body>

</html>
